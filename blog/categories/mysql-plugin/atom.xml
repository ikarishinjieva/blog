<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: mysql_plugin | Tac say]]></title>
  <link href="http://ikarishinjieva.github.com/blog/blog/categories/mysql-plugin/atom.xml" rel="self"/>
  <link href="http://ikarishinjieva.github.com/blog/"/>
  <updated>2014-01-28T17:00:32+08:00</updated>
  <id>http://ikarishinjieva.github.com/blog/</id>
  <author>
    <name><![CDATA[Tac Huang (ikari_shinji@github)]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[编译mysql插件的碰到的问题]]></title>
    <link href="http://ikarishinjieva.github.com/blog/blog/2014/01/28/compile-mysql-plugin/"/>
    <updated>2014-01-28T16:48:00+08:00</updated>
    <id>http://ikarishinjieva.github.com/blog/blog/2014/01/28/compile-mysql-plugin</id>
    <content type="html"><![CDATA[<p>最近尝试制作了<a href="https://github.com/ikarishinjieva/mysql_plugin-binlog_dump_list">一个mysql的插件</a>. 对c/c++的编译不熟, 又是第一次尝试做mysql插件, 编译过程中碰到些状况</p>

<p>编写好mysql插件后, 编译成功, 在mysql中安装运行报错: 取了<code>threads</code>中的THD, 其中THD->thread_id值为空</p>

<p>由于是mysql内置的数据结构, 一时没了头绪, 只能通过gdb连上去看看</p>

<p>发现plugin打印出来的thread_id距离THD开头的距离为</p>

<pre><code>tmp=0x3661f80
&amp;tmp-&gt;thread_id=0x36637b0
delta = 0x1830
</code></pre>

<p>而gdb打印出来的距离为</p>

<pre><code>(gdb) p tmp
$1 = (THD *) 0x3661f80
(gdb) p &amp;tmp-&gt;thread_id
$2 = (my_thread_id *) 0x3663878
delta = 0x18F8
</code></pre>

<p>结论很显然, plugin编译的THD结构和mysqld的THD结构不匹配, 即plugin的编译参数和mysqld的编译参数不一样.</p>

<p>当然mysql的文档上只会说一句大意是 "<strong>编译参数应当设置成一样的</strong>"的话</p>

<p>其中比较重要的几个编译选项</p>

<ol>
<li>DBUG_ON</li>
<li>SAFE_MUTEX</li>
<li>DBUG_OFF (不设置DBUG_ON并不等于DBUG_OFF)</li>
</ol>


<p>这几个选项会影响当使用mysqld内部数据结构的长度, 不排除还有其他</p>
]]></content>
  </entry>
  
</feed>
