<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: temporary_table | Tac say]]></title>
  <link href="http://ikarishinjieva.github.com/blog/blog/categories/temporary-table/atom.xml" rel="self"/>
  <link href="http://ikarishinjieva.github.com/blog/"/>
  <updated>2014-06-15T11:23:47+08:00</updated>
  <id>http://ikarishinjieva.github.com/blog/</id>
  <author>
    <name><![CDATA[Tac Huang (ikari_shinji@github)]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[测试Mysql临时表的复制]]></title>
    <link href="http://ikarishinjieva.github.com/blog/blog/2014/06/12/temporary-table-replication/"/>
    <updated>2014-06-12T22:32:00+08:00</updated>
    <id>http://ikarishinjieva.github.com/blog/blog/2014/06/12/temporary-table-replication</id>
    <content type="html"><![CDATA[<p>测试一下Mysql 5.6.17对临时表的复制</p>

<h4>参考资料</h4>

<ol>
<li>Percona这篇08年的blog <a href="http://www.mysqlperformanceblog.com/2008/05/26/mysql-temporary-tables-safe-for-statement-based-replication/">Can MySQL temporary tables be made safe for statement-based replication?</a>, 是对于Mysql 5.1这方面的测试. 但根据对Mysql 5.6的相关测试, 其结论已经不适用. 其方法可供参考</li>
<li><p>Mysql Manual 对于临时表复制的<a href="http://dev.mysql.com/doc/refman/5.6/en/replication-features-temptables.html">讨论</a>, 其中一些重要的描述列在下面:</p></li>
<li><p>Safe slave shutdown when using temporary tables</p></li>
<li>By default, all temporary tables are replicated; this happens whether or not there are any matching <code>--replicate-do-db</code>, <code>--replicate-do-table</code>, or <code>--replicate-wild-do-table</code> options in effect</li>
<li>the <code>--replicate-ignore-table</code> and <code>--replicate-wild-ignore-table</code> options are honored for temporary tables</li>
</ol>


<h4>概述</h4>

<p>总共做了两个测试:</p>

<ol>
<li>Mysql Manual中"Safe slave shutdown when using temporary tables"一节, 验证为何需要如此安全关闭slave</li>
<li>验证在复制临时表时, master意外crash, 是否会造成slave上的资源泄露</li>
</ol>


<p>每个测试后都有结论</p>

<h4>测试一</h4>

<p>针对Mysql Manual提到的"Safe slave shutdown when using temporary tables", 重现一下:</p>

<p>```</p>

<h1>准备环境, 断开复制</h1>

<p>mysql-master> select @@binlog_format;
+-----------------+
| @@binlog_format |
+-----------------+
| MIXED           |
+-----------------+
1 row in set (0.02 sec)</p>

<p>mysql-slave> stop slave;
Query OK, 0 rows affected (0.03 sec)
```</p>

<p>```</p>

<h1>在master上构造使用临时表的两个transaction</h1>

<p>mysql-master> flush logs;
Query OK, 0 rows affected (0.02 sec)</p>

<p>mysql-master> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-master> create temporary table test.t(t int);
Query OK, 0 rows affected (0.01 sec)</p>

<p>mysql-master> commit;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-master> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-master> insert into test.a select t from test.t;
Query OK, 0 rows affected (0.00 sec)
Records: 0  Duplicates: 0  Warnings: 0</p>

<p>mysql-master> commit;
Query OK, 0 rows affected (0.00 sec)
```</p>

<p>```</p>

<h1>查看master的binlog</h1>

<p>mysql-master> show binlog events in "mysql-bin.000036" \G
<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 1. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000036</p>

<pre><code>    Pos: 4
</code></pre>

<p> Event_type: Format_desc
  Server_id: 1
End_log_pos: 120</p>

<pre><code>   Info: Server ver: 5.6.17-debug-log, Binlog ver: 4
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 2. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000036</p>

<pre><code>    Pos: 120
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 195</p>

<pre><code>   Info: BEGIN
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 3. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000036</p>

<pre><code>    Pos: 195
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 301</p>

<pre><code>   Info: create temporary table test.t(t int)
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 4. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000036</p>

<pre><code>    Pos: 301
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 370</p>

<pre><code>   Info: COMMIT
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 5. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000036</p>

<pre><code>    Pos: 370
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 445</p>

<pre><code>   Info: BEGIN
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 6. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000036</p>

<pre><code>    Pos: 445
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 554</p>

<pre><code>   Info: insert into test.a select t from test.t
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 7. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000036</p>

<pre><code>    Pos: 554
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 623</p>

<pre><code>   Info: COMMIT
</code></pre>

<p>7 rows in set (0.00 sec)
```</p>

<p>```</p>

<h1>开启复制,让复制在两个transaction之间中断</h1>

<p>mysql-slave> start slave until master_log_file='mysql-bin.000036', master_log_pos=370;
Query OK, 0 rows affected, 1 warning (0.02 sec)</p>

<p>mysql-slave> show slave status\G
<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 1. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>

<pre><code>           Slave_IO_State: Waiting for master to send event
</code></pre>

<p>...</p>

<pre><code>          Master_Log_File: mysql-bin.000036
      Read_Master_Log_Pos: 623
</code></pre>

<p>...</p>

<pre><code>    Relay_Master_Log_File: mysql-bin.000036
         Slave_IO_Running: Yes
        Slave_SQL_Running: No
</code></pre>

<p>...</p>

<pre><code>      Exec_Master_Log_Pos: 370
</code></pre>

<p>...
1 row in set (0.00 sec)</p>

<p>```</p>

<p>```</p>

<h1>查看slave正在使用的临时表, 并重启slave</h1>

<p>mysql-slave> show status like '%temp%';                    <br/>
+------------------------+-------+
| Variable_name          | Value |
+------------------------+-------+
| Slave_open_temp_tables | 1     |
+------------------------+-------+
1 row in set (0.01 sec)</p>

<p>slave> service mysqld restart
```</p>

<p>```</p>

<h1>验证slave status</h1>

<p>mysql-slave> show slave status\G
<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 1. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
...</p>

<pre><code>          Master_Log_File: mysql-bin.000036
      Read_Master_Log_Pos: 623
</code></pre>

<p>...</p>

<pre><code>    Relay_Master_Log_File: mysql-bin.000036
         Slave_IO_Running: Yes
        Slave_SQL_Running: No
</code></pre>

<p>...</p>

<pre><code>               Last_Errno: 1146
               Last_Error: Error 'Table 'test.t' doesn't exist' on query. Default database: ''. Query: 'insert into test.a select t from test.t'
</code></pre>

<p>...</p>

<pre><code>      Exec_Master_Log_Pos: 370
</code></pre>

<p>...</p>

<pre><code>           Last_SQL_Errno: 1146
           Last_SQL_Error: Error 'Table 'test.t' doesn't exist' on query. Default database: ''. Query: 'insert into test.a select t from test.t'
</code></pre>

<p>  Replicate_Ignore_Server_Ids:
...
1 row in set (0.00 sec)</p>

<p>```</p>

<p><strong>结论</strong>: 使用临时表时, slave并不保证crash-safe, 而且若在连续的transaction中复用同一个临时表, 完全没办法安全修复.</p>

<h4>测试2</h4>

<p>对于一个<code>create temporary table</code>, 已知<code>drop temporary table</code>会在session结束时写进binlog. 那么如果master意外退出, 是不是会对slave造成资源泄露? 比如不释放文件句柄</p>

<p>```</p>

<h1>准备master环境</h1>

<p>mysql-master> select @@binlog_format;
+-----------------+
| @@binlog_format |
+-----------------+
| MIXED           |
+-----------------+
1 row in set (0.00 sec)</p>

<p>mysql-master> select @@gtid_mode;
+-------------+
| @@gtid_mode |
+-------------+
| OFF         |
+-------------+
1 row in set (0.00 sec)
```</p>

<p>```</p>

<h1>检查slave上的资源</h1>

<p>mysql-slave> show status like '%open%';
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
...
| Innodb_num_open_files      | 6     |
| Open_files                 | 22    |
| Open_streams               | 0     |
| Open_table_definitions     | 70    |
| Open_tables                | 63    |
| Opened_files               | 164   |
| Opened_table_definitions   | 0     |
| Opened_tables              | 0     |
| Slave_open_temp_tables     | 0     |
...
+----------------------------+-------+
14 rows in set (0.00 sec)
```</p>

<p>```</p>

<h1>在master上创建5张临时表</h1>

<p>mysql-master> create temporary table test.t1 (t int);create temporary table test.t2 (t int);create temporary table test.t3 (t int);create temporary table test.t4 (t int);create temporary table test.t5 (t int);
Query OK, 0 rows affected (0.02 sec)</p>

<p>Query OK, 0 rows affected (0.00 sec)</p>

<p>Query OK, 0 rows affected (0.01 sec)</p>

<p>Query OK, 0 rows affected (0.01 sec)</p>

<p>Query OK, 0 rows affected (0.01 sec)</p>

<p>```</p>

<p>```</p>

<h1>检查slave上的资源</h1>

<p>mysql-slave> show status like '%open%';
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
...
| Innodb_num_open_files      | 11    |
| Open_files                 | 22    |
| Open_streams               | 0     |
| Open_table_definitions     | 70    |
| Open_tables                | 63    |
| Opened_files               | 179   |
| Opened_table_definitions   | 0     |
| Opened_tables              | 0     |
| Slave_open_temp_tables     | 5     |
...
+----------------------------+-------+
14 rows in set (0.00 sec)
```</p>

<p>```</p>

<h1>引发master故障, 重启master库</h1>

<p>master> pkill -9 mysqld
master> /opt/mysql/bin/mysqld_safe &amp;
```</p>

<p>```</p>

<h1>重启slave复制, 检查slave上的资源</h1>

<p>mysql-slave> stop slave io_thread;
Query OK, 0 rows affected (0.02 sec)</p>

<p>mysql-slave> start slave io_thread;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-slave> show status like '%open%';
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
...
| Innodb_num_open_files      | 6     |
| Open_files                 | 22    |
| Open_streams               | 0     |
| Open_table_definitions     | 70    |
| Open_tables                | 63    |
| Opened_files               | 209   |
| Opened_table_definitions   | 0     |
| Opened_tables              | 0     |
| Slave_open_temp_tables     | 5     |
...
+----------------------------+-------+
14 rows in set (0.00 sec)
```</p>

<p>```</p>

<h1>在master上再次创建5张临时表, 检查slave上的资源</h1>

<p>mysql-master> create temporary table test.t1 (t int);create temporary table test.t2 (t int);create temporary table test.t3 (t int);create temporary table test.t4 (t int);create temporary table test.t5 (t int);
Query OK, 0 rows affected (0.09 sec)</p>

<p>Query OK, 0 rows affected (0.00 sec)</p>

<p>Query OK, 0 rows affected (0.02 sec)</p>

<p>Query OK, 0 rows affected (0.00 sec)</p>

<p>Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-slave> show status like '%open%';
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
...
| Innodb_num_open_files      | 11    |
| Open_files                 | 22    |
| Open_streams               | 0     |
| Open_table_definitions     | 70    |
| Open_tables                | 63    |
| Opened_files               | 224   |
| Opened_table_definitions   | 0     |
| Opened_tables              | 0     |
| Slave_open_temp_tables     | 10    |
...
+----------------------------+-------+
```</p>

<p><strong>结论</strong>: 复制临时表时,slave上消耗的资源, <code>Innodb_num_open_files</code>会及时回收,也就是说实际消耗的系统资源被及时回收. 但<code>Slave_open_temp_tables</code>会虚高不下,按照Mysql Manual中"Safe slave shutdown when using temporary tables"的叙述, 用<code>Slave_open_temp_tables</code>来判断关闭server的时机时, 会出现判断失误.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[测试Mysql临时表的binlog]]></title>
    <link href="http://ikarishinjieva.github.com/blog/blog/2014/06/12/temporary-table-binlog/"/>
    <updated>2014-06-12T22:30:00+08:00</updated>
    <id>http://ikarishinjieva.github.com/blog/blog/2014/06/12/temporary-table-binlog</id>
    <content type="html"><![CDATA[<p>在Mysql 5.6.17上测试临时表生成的binlog</p>

<h3>测试用例</h3>

<p>(现在用的jekyll对table显示有点问题, 请意会...)</p>

<table>
<thead>
<tr>
<th></th>
<th>用例</th>
<th>row</th>
<th>statement</th>
<th>mixed</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>create temporary table</code> 产生的binlog</td>
<td>1.1</td>
<td>1.2</td>
<td>1.3|</td>
</tr>
<tr>
<td></td>
<td><code>create temporary table</code> 产生的binlog (<code>mysqlbinlog</code>)</td>
<td>2.1</td>
<td>2.2</td>
<td>-|</td>
</tr>
<tr>
<td></td>
<td>临时表对非临时表数据产生影响时, 产生的binlog</td>
<td>3.1</td>
<td>3.2</td>
<td>-|</td>
</tr>
<tr>
<td></td>
<td>临时表对非临时表数据产生影响, 并rollback时, 产生的binlog</td>
<td>4.1</td>
<td>4.2</td>
<td>-|</td>
</tr>
<tr>
<td></td>
<td>多session同时创建临时表, 产生的binlog</td>
<td>-</td>
<td>5.1</td>
<td>-|</td>
</tr>
<tr>
<td></td>
<td>开启<code>enforce-gtid-consistency</code>时, <code>create temporary table</code></td>
<td>-</td>
<td>6.1</td>
<td>-|</td>
</tr>
</tbody>
</table>


<h3>测试结论</h3>

<h4>1. <code>create temporary table</code> 产生的binlog</h4>

<p>结论: 可以看到<code>statement</code>和<code>mixed</code>模式生成的binlog一样. 而<code>row</code>模式中, 因为临时表并没有产生实际影响, 所以没有产生额外的binlog event</p>

<h4>2. <code>create temporary table</code> 产生的binlog (<code>mysqlbinlog</code>)</h4>

<p><code>show binlog events</code> 的输出只是摘要了binlog的内容, <code>mysqlbinlog</code>的输出才能精准的显示binlog的内容</p>

<p>重做<code>row</code>模式和<code>statement</code>模式的测试, 可以看到<code>row</code>模式虽然不产生<code>create temporary table</code>, 但是会产生一个<code>drop temporary table if exists</code>; <code>statement</code>模式产生<code>create temporary table</code>, 但不产生<code>drop temporary table</code></p>

<h4>3. 临时表对非临时表数据产生影响时, 产生的binlog</h4>

<p>可以看到<code>row</code>模式会产生非临时表的行日志.<code>statement</code>模式会严格记录语句.</p>

<h4>4. 临时表对非临时表数据产生影响,并rollback时, 产生的binlog</h4>

<p>可以看到<code>row</code>模式下, rollback不会对binlog产生影响. 在<code>statement</code>模式下, 所有的语句都会如实反映在binlog里, 并进行rollback</p>

<h4>5. 多session同时创建临时表, 产生的binlog</h4>

<p>不同于典型DDL, <code>create temporary table</code>记在transaction中.</p>

<p>由session结束产生的<code>drop temporary table</code>则类似于典型的DDL.</p>

<h4>6. 开启<code>enforce-gtid-consistency</code>时, <code>create temporary table</code></h4>

<p>开启<code>enforce-gtid-consistency</code>时, 在transaction内创建临时表会得到warning:</p>

<p><code>
ERROR 1787 (HY000): When @@GLOBAL.ENFORCE_GTID_CONSISTENCY = 1, the statements CREATE TEMPORARY TABLE and DROP TEMPORARY TABLE can be executed in a non-transactional context only, and require that AUTOCOMMIT = 1.
</code></p>

<hr />

<h3>元日志</h3>

<h4>1.1</h4>

<p>```
mysql> select @@gtid_mode;
+-------------+
| @@gtid_mode |
+-------------+
| OFF         |
+-------------+
1 row in set (0.00 sec)</p>

<p>mysql> set @@session.binlog_format="row";
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> flush logs;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> create temporary table test.t (t int);
Query OK, 0 rows affected (0.01 sec)</p>

<p>mysql> commit;
Query OK, 0 rows affected (0.00 sec)
```</p>

<p>```
mysql> show binlog events in 'mysql-bin.000014' \G
<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 1. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000014</p>

<pre><code>    Pos: 4
</code></pre>

<p> Event_type: Format_desc
  Server_id: 1
End_log_pos: 120</p>

<pre><code>   Info: Server ver: 5.6.17-debug-log, Binlog ver: 4
</code></pre>

<p>```</p>

<h4>1.2</h4>

<p>```
mysql> select @@gtid_mode;</p>

<p>+-------------+
| @@gtid_mode |
+-------------+
| OFF         |
+-------------+
1 row in set (0.00 sec)</p>

<p>mysql> set @@session.binlog_format="statement";
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> flush logs;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> create temporary table test.t (t int);
Query OK, 0 rows affected (0.01 sec)</p>

<p>mysql> commit;
Query OK, 0 rows affected (0.00 sec)
```</p>

<p>```
mysql> show binlog events in 'mysql-bin.000015' \G
<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 1. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000015</p>

<pre><code>    Pos: 4
</code></pre>

<p> Event_type: Format_desc
  Server_id: 1
End_log_pos: 120</p>

<pre><code>   Info: Server ver: 5.6.17-debug-log, Binlog ver: 4
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 2. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000015</p>

<pre><code>    Pos: 120
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 195</p>

<pre><code>   Info: BEGIN
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 3. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000015</p>

<pre><code>    Pos: 195
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 302</p>

<pre><code>   Info: create temporary table test.t (t int)
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 4. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000015</p>

<pre><code>    Pos: 302
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 371</p>

<pre><code>   Info: COMMIT
</code></pre>

<p>4 rows in set (0.00 sec)
```</p>

<h4>1.3</h4>

<p>```
mysql> select @@gtid_mode;
+-------------+
| @@gtid_mode |
+-------------+
| OFF         |
+-------------+
1 row in set (0.01 sec)</p>

<p>mysql> select @@binlog_format;
+-----------------+
| @@binlog_format |
+-----------------+
| MIXED           |
+-----------------+
1 row in set (0.01 sec)</p>

<p>mysql> flush logs;
Query OK, 0 rows affected (0.02 sec)</p>

<p>mysql> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> create temporary table test.t (t int);
Query OK, 0 rows affected (0.05 sec)</p>

<p>mysql> commit;
Query OK, 0 rows affected (0.00 sec)
```</p>

<p>```
mysql> show binlog events in 'mysql-bin.000011'\G
<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 1. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000011</p>

<pre><code>    Pos: 4
</code></pre>

<p> Event_type: Format_desc
  Server_id: 1
End_log_pos: 120</p>

<pre><code>   Info: Server ver: 5.6.17-debug-log, Binlog ver: 4
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 2. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000011</p>

<pre><code>    Pos: 120
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 195</p>

<pre><code>   Info: BEGIN
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 3. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000011</p>

<pre><code>    Pos: 195
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 302</p>

<pre><code>   Info: create temporary table test.t (t int)
</code></pre>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 4. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>
   Log_name: mysql-bin.000011</p>

<pre><code>    Pos: 302
</code></pre>

<p> Event_type: Query
  Server_id: 1
End_log_pos: 371</p>

<pre><code>   Info: COMMIT
</code></pre>

<p>```</p>

<h4>2.1</h4>

<p>```
[root@localhost data]# /opt/mysql/bin/mysqlbinlog --base64-output=decode-rows mysql-bin.000014
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1</em>/;
/<em>!40019 SET @@session.max_insert_delayed_threads=0</em>/;
/<em>!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0</em>/;
DELIMITER /<em>!</em>/;</p>

<h1>at 4</h1>

<h1>140612  4:38:58 server id 1  end_log_pos 120 CRC32 0xb935033a  Start: binlog v 4, server v 5.6.17-debug-log created 140612  4:38:58</h1>

<h1>at 120</h1>

<h1>140612  4:42:30 server id 1  end_log_pos 257 CRC32 0x8f9ccf27  Query   thread_id=2 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402548150/<em>!</em>/;
SET @@session.pseudo_thread_id=2/<em>!</em>/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/<em>!</em>/;
SET @@session.sql_mode=1075838976/<em>!</em>/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/<em>!</em>/;
/<em>!\C utf8 </em>//<em>!</em>/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=33/<em>!</em>/;
SET @@session.lc_time_names=0/<em>!</em>/;
SET @@session.collation_database=DEFAULT/<em>!</em>/;
DROP TEMPORARY TABLE IF EXISTS <code>test</code>.<code>t</code> /<em> generated by server </em>/
/<em>!</em>/;</p>

<h1>at 257</h1>

<h1>140612  4:42:51 server id 1  end_log_pos 304 CRC32 0x62766a77  Rotate to mysql-bin.000015  pos: 4</h1>

<p>DELIMITER ;</p>

<h1>End of log file</h1>

<p>ROLLBACK /<em> added by mysqlbinlog </em>/;
/<em>!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE</em>/;
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0</em>/;
```</p>

<h4>2.2</h4>

<p>```
[root@localhost data]# /opt/mysql/bin/mysqlbinlog --base64-output=decode-rows mysql-bin.000015
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1</em>/;
/<em>!40019 SET @@session.max_insert_delayed_threads=0</em>/;
/<em>!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0</em>/;
DELIMITER /<em>!</em>/;</p>

<h1>at 4</h1>

<h1>140612  4:42:51 server id 1  end_log_pos 120 CRC32 0xc3707cb7  Start: binlog v 4, server v 5.6.17-debug-log created 140612  4:42:51</h1>

<h1>Warning: this binlog is either in use or was not closed properly.</h1>

<h1>at 120</h1>

<h1>140612  4:42:58 server id 1  end_log_pos 195 CRC32 0x2fd0ed95  Query   thread_id=2 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402548178/<em>!</em>/;
SET @@session.pseudo_thread_id=2/<em>!</em>/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/<em>!</em>/;
SET @@session.sql_mode=1075838976/<em>!</em>/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/<em>!</em>/;
/<em>!\C utf8 </em>//<em>!</em>/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=33/<em>!</em>/;
SET @@session.lc_time_names=0/<em>!</em>/;
SET @@session.collation_database=DEFAULT/<em>!</em>/;
BEGIN
/<em>!</em>/;</p>

<h1>at 195</h1>

<h1>140612  4:42:58 server id 1  end_log_pos 302 CRC32 0xfc742b50  Query   thread_id=2 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402548178/<em>!</em>/;
create temporary table test.t (t int)
/<em>!</em>/;</p>

<h1>at 302</h1>

<h1>140612  4:43:00 server id 1  end_log_pos 371 CRC32 0x25648832  Query   thread_id=2 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402548180/<em>!</em>/;
COMMIT
/<em>!</em>/;
DELIMITER ;</p>

<h1>End of log file</h1>

<p>ROLLBACK /<em> added by mysqlbinlog </em>/;
/<em>!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE</em>/;
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0</em>/;
```</p>

<h4>3.1</h4>

<p>```
mysql> select @@gtid_mode;
+-------------+
| @@gtid_mode |
+-------------+
| OFF         |
+-------------+
1 row in set (0.00 sec)</p>

<p>mysql> set @@session.binlog_format="row";
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> flush logs;
Query OK, 0 rows affected (0.01 sec)</p>

<p>mysql> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql>  create temporary table test.t (t int);
Query OK, 0 rows affected (0.01 sec)</p>

<p>mysql> insert into test.t values(2);
Query OK, 1 row affected (0.00 sec)</p>

<p>mysql> insert into test.a select t from test.t;
Query OK, 1 row affected (0.00 sec)
Records: 1  Duplicates: 0  Warnings: 0</p>

<p>mysql> commit;
Query OK, 0 rows affected (0.01 sec)
```</p>

<p>```
[root@localhost data]# /opt/mysql/bin/mysqlbinlog --base64-output=decode-rows -v mysql-bin.000020
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1</em>/;
/<em>!40019 SET @@session.max_insert_delayed_threads=0</em>/;
/<em>!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0</em>/;
DELIMITER /<em>!</em>/;</p>

<h1>at 4</h1>

<h1>140612  6:02:38 server id 1  end_log_pos 120 CRC32 0x31b6357c  Start: binlog v 4, server v 5.6.17-debug-log created 140612  6:02:38</h1>

<h1>Warning: this binlog is either in use or was not closed properly.</h1>

<h1>at 120</h1>

<h1>140612  6:02:53 server id 1  end_log_pos 188 CRC32 0x23bceabc  Query   thread_id=6 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402552973/<em>!</em>/;
SET @@session.pseudo_thread_id=6/<em>!</em>/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/<em>!</em>/;
SET @@session.sql_mode=1075838976/<em>!</em>/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/<em>!</em>/;
/<em>!\C utf8 </em>//<em>!</em>/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=33/<em>!</em>/;
SET @@session.lc_time_names=0/<em>!</em>/;
SET @@session.collation_database=DEFAULT/<em>!</em>/;
BEGIN
/<em>!</em>/;</p>

<h1>at 188</h1>

<h1>140612  6:02:53 server id 1  end_log_pos 232 CRC32 0x1a87cc74  Table_map: <code>test</code>.<code>a</code> mapped to number 70</h1>

<h1>at 232</h1>

<h1>140612  6:02:53 server id 1  end_log_pos 272 CRC32 0xf0c862fb  Write_rows: table id 70 flags: STMT_END_F</h1>

<h3>INSERT INTO <code>test</code>.<code>a</code></h3>

<h3>SET</h3>

<h3>@1=2</h3>

<h1>at 272</h1>

<h1>140612  6:02:55 server id 1  end_log_pos 303 CRC32 0xb2f66e82  Xid = 92</h1>

<p>COMMIT/<em>!</em>/;
DELIMITER ;</p>

<h1>End of log file</h1>

<p>ROLLBACK /<em> added by mysqlbinlog </em>/;
/<em>!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE</em>/;
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0</em>/;
```</p>

<h4>3.2</h4>

<p>```
mysql> select @@gtid_mode;
+-------------+
| @@gtid_mode |
+-------------+
| OFF         |
+-------------+
1 row in set (0.00 sec)</p>

<p>mysql> set @@session.binlog_format="statement";
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> flush logs;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> create temporary table test.t (t int);
Query OK, 0 rows affected (0.01 sec)</p>

<p>mysql> insert into test.t values(3);
Query OK, 1 row affected (0.00 sec)</p>

<p>mysql> insert into test.a select t from test.t;
Query OK, 1 row affected (0.00 sec)
Records: 1  Duplicates: 0  Warnings: 0</p>

<p>mysql> commit;
Query OK, 0 rows affected (0.00 sec)
```</p>

<p>```
[root@localhost data]# /opt/mysql/bin/mysqlbinlog --base64-output=decode-rows mysql-bin.000021
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1</em>/;
/<em>!40019 SET @@session.max_insert_delayed_threads=0</em>/;
/<em>!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0</em>/;
DELIMITER /<em>!</em>/;</p>

<h1>at 4</h1>

<h1>140612  6:07:43 server id 1  end_log_pos 120 CRC32 0xbcd985c3  Start: binlog v 4, server v 5.6.17-debug-log created 140612  6:07:43</h1>

<h1>Warning: this binlog is either in use or was not closed properly.</h1>

<h1>at 120</h1>

<h1>140612  6:07:50 server id 1  end_log_pos 195 CRC32 0xf5ea27f6  Query   thread_id=7 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402553270/<em>!</em>/;
SET @@session.pseudo_thread_id=7/<em>!</em>/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/<em>!</em>/;
SET @@session.sql_mode=1075838976/<em>!</em>/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/<em>!</em>/;
/<em>!\C utf8 </em>//<em>!</em>/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=33/<em>!</em>/;
SET @@session.lc_time_names=0/<em>!</em>/;
SET @@session.collation_database=DEFAULT/<em>!</em>/;
BEGIN
/<em>!</em>/;</p>

<h1>at 195</h1>

<h1>140612  6:07:50 server id 1  end_log_pos 302 CRC32 0xa52fbe74  Query   thread_id=7 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402553270/<em>!</em>/;
create temporary table test.t (t int)
/<em>!</em>/;</p>

<h1>at 302</h1>

<h1>140612  6:07:55 server id 1  end_log_pos 400 CRC32 0x037b8754  Query   thread_id=7 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402553275/<em>!</em>/;
insert into test.t values(3)
/<em>!</em>/;</p>

<h1>at 400</h1>

<h1>140612  6:07:59 server id 1  end_log_pos 509 CRC32 0xa1dc2124  Query   thread_id=7 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402553279/<em>!</em>/;
insert into test.a select t from test.t
/<em>!</em>/;</p>

<h1>at 509</h1>

<h1>140612  6:08:01 server id 1  end_log_pos 540 CRC32 0xf7e3aa59  Xid = 102</h1>

<p>COMMIT/<em>!</em>/;
DELIMITER ;</p>

<h1>End of log file</h1>

<p>ROLLBACK /<em> added by mysqlbinlog </em>/;
/<em>!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE</em>/;
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0</em>/;
```</p>

<h4>4.1</h4>

<p>```
mysql> select @@gtid_mode;
+-------------+
| @@gtid_mode |
+-------------+
| OFF         |
+-------------+
1 row in set (0.00 sec)</p>

<p>mysql> set @@session.binlog_format="row";
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> flush logs;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> create temporary table test.t (t int);
Query OK, 0 rows affected (0.01 sec)</p>

<p>mysql> insert into test.t values(5);
Query OK, 1 row affected (0.01 sec)</p>

<p>mysql> insert into test.a select t from test.t;
Query OK, 1 row affected (0.00 sec)
Records: 1  Duplicates: 0  Warnings: 0</p>

<p>mysql> rollback;
Query OK, 0 rows affected, 1 warning (0.00 sec)</p>

<p>mysql> show warnings;
+---------+------+-----------------------------------------------------------------+
| Level   | Code | Message                                                         |
+---------+------+-----------------------------------------------------------------+
| Warning | 1751 | The creation of some temporary tables could not be rolled back. |
+---------+------+-----------------------------------------------------------------+
1 row in set (0.00 sec)
```</p>

<p>```
[root@localhost data]# /opt/mysql/bin/mysqlbinlog --base64-output=decode-rows mysql-bin.000024
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1</em>/;
/<em>!40019 SET @@session.max_insert_delayed_threads=0</em>/;
/<em>!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0</em>/;
DELIMITER /<em>!</em>/;</p>

<h1>at 4</h1>

<h1>140612  6:25:58 server id 1  end_log_pos 120 CRC32 0x8f8f4247  Start: binlog v 4, server v 5.6.17-debug-log created 140612  6:25:58</h1>

<h1>Warning: this binlog is either in use or was not closed properly.</h1>

<p>DELIMITER ;</p>

<h1>End of log file</h1>

<p>ROLLBACK /<em> added by mysqlbinlog </em>/;
/<em>!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE</em>/;
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0</em>/;
```</p>

<h4>4.2</h4>

<p>```
mysql> select @@gtid_mode;
+-------------+
| @@gtid_mode |
+-------------+
| OFF         |
+-------------+
1 row in set (0.00 sec)</p>

<p>mysql> set @@session.binlog_format="statement";
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> flush logs;
Query OK, 0 rows affected (0.01 sec)</p>

<p>mysql> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> create temporary table test.t (t int);
Query OK, 0 rows affected (0.01 sec)</p>

<p>mysql> insert into test.t values(4);
Query OK, 1 row affected (0.00 sec)</p>

<p>mysql> insert into test.a select t from test.t;
Query OK, 1 row affected (0.00 sec)
Records: 1  Duplicates: 0  Warnings: 0</p>

<p>mysql> rollback;
Query OK, 0 rows affected, 1 warning (0.00 sec)</p>

<p>mysql> show warnings;
+---------+------+-----------------------------------------------------------------+
| Level   | Code | Message                                                         |
+---------+------+-----------------------------------------------------------------+
| Warning | 1751 | The creation of some temporary tables could not be rolled back. |
+---------+------+-----------------------------------------------------------------+
1 row in set (0.00 sec)
```</p>

<p>```
[root@localhost data]# /opt/mysql/bin/mysqlbinlog --base64-output=decode-rows mysql-bin.000023
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1</em>/;
/<em>!40019 SET @@session.max_insert_delayed_threads=0</em>/;
/<em>!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0</em>/;
DELIMITER /<em>!</em>/;</p>

<h1>at 4</h1>

<h1>140612  6:22:03 server id 1  end_log_pos 120 CRC32 0x8ebd7db6  Start: binlog v 4, server v 5.6.17-debug-log created 140612  6:22:03</h1>

<h1>Warning: this binlog is either in use or was not closed properly.</h1>

<h1>at 120</h1>

<h1>140612  6:22:13 server id 1  end_log_pos 195 CRC32 0x2ef37ea7  Query   thread_id=9 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402554133/<em>!</em>/;
SET @@session.pseudo_thread_id=9/<em>!</em>/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/<em>!</em>/;
SET @@session.sql_mode=1075838976/<em>!</em>/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/<em>!</em>/;
/<em>!\C utf8 </em>//<em>!</em>/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=33/<em>!</em>/;
SET @@session.lc_time_names=0/<em>!</em>/;
SET @@session.collation_database=DEFAULT/<em>!</em>/;
BEGIN
/<em>!</em>/;</p>

<h1>at 195</h1>

<h1>140612  6:22:13 server id 1  end_log_pos 302 CRC32 0xc642d4a1  Query   thread_id=9 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402554133/<em>!</em>/;
create temporary table test.t (t int)
/<em>!</em>/;</p>

<h1>at 302</h1>

<h1>140612  6:22:17 server id 1  end_log_pos 400 CRC32 0x076861c4  Query   thread_id=9 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402554137/<em>!</em>/;
insert into test.t values(4)
/<em>!</em>/;</p>

<h1>at 400</h1>

<h1>140612  6:22:21 server id 1  end_log_pos 509 CRC32 0x2e43db50  Query   thread_id=9 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402554141/<em>!</em>/;
insert into test.a select t from test.t
/<em>!</em>/;</p>

<h1>at 509</h1>

<h1>140612  6:22:24 server id 1  end_log_pos 580 CRC32 0xdefa8f3d  Query   thread_id=9 exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402554144/<em>!</em>/;
ROLLBACK
/<em>!</em>/;
DELIMITER ;</p>

<h1>End of log file</h1>

<p>ROLLBACK /<em> added by mysqlbinlog </em>/;
/<em>!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE</em>/;
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0</em>/;
```</p>

<h4>5.1</h4>

<p>```
mysql-session1> set @@session.binlog_format="statement";
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-session2> set @@session.binlog_format="statement";
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-session1> flush logs;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-session1> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-session1> create temporary table test.t(t int);
Query OK, 0 rows affected (0.01 sec)</p>

<p>mysql-session2> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-session2> create temporary table test.t(t int);
Query OK, 0 rows affected (0.02 sec)</p>

<p>mysql-session1> commit;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-session2> commit;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql-session1> exit;
Bye</p>

<p>mysql-session2> exit;
Bye
```</p>

<p>```</p>

<p>[root@localhost data]# /opt/mysql/bin/mysqlbinlog --base64-output=decode-rows mysql-bin.000028
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1</em>/;
/<em>!40019 SET @@session.max_insert_delayed_threads=0</em>/;
/<em>!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0</em>/;
DELIMITER /<em>!</em>/;</p>

<h1>at 4</h1>

<h1>140612  6:45:24 server id 1  end_log_pos 120 CRC32 0x0ad8e5a0  Start: binlog v 4, server v 5.6.17-debug-log created 140612  6:45:24</h1>

<h1>Warning: this binlog is either in use or was not closed properly.</h1>

<h1>at 120</h1>

<h1>140612  6:45:58 server id 1  end_log_pos 195 CRC32 0x59b581d0  Query   thread_id=14    exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402555558/<em>!</em>/;
SET @@session.pseudo_thread_id=14/<em>!</em>/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/<em>!</em>/;
SET @@session.sql_mode=1075838976/<em>!</em>/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/<em>!</em>/;
/<em>!\C utf8 </em>//<em>!</em>/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=33/<em>!</em>/;
SET @@session.lc_time_names=0/<em>!</em>/;
SET @@session.collation_database=DEFAULT/<em>!</em>/;
BEGIN
/<em>!</em>/;</p>

<h1>at 195</h1>

<h1>140612  6:45:58 server id 1  end_log_pos 301 CRC32 0x274004b9  Query   thread_id=14    exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402555558/<em>!</em>/;
create temporary table test.t(t int)
/<em>!</em>/;</p>

<h1>at 301</h1>

<h1>140612  6:46:54 server id 1  end_log_pos 370 CRC32 0x9f2ca921  Query   thread_id=14    exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402555614/<em>!</em>/;
COMMIT
/<em>!</em>/;</p>

<h1>at 370</h1>

<h1>140612  6:46:17 server id 1  end_log_pos 445 CRC32 0x3f1094c3  Query   thread_id=16    exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402555577/<em>!</em>/;
SET @@session.pseudo_thread_id=16/<em>!</em>/;
BEGIN
/<em>!</em>/;</p>

<h1>at 445</h1>

<h1>140612  6:46:17 server id 1  end_log_pos 551 CRC32 0x754cae85  Query   thread_id=16    exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402555577/<em>!</em>/;
create temporary table test.t(t int)
/<em>!</em>/;</p>

<h1>at 551</h1>

<h1>140612  6:46:58 server id 1  end_log_pos 620 CRC32 0x73eb6f5a  Query   thread_id=16    exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402555618/<em>!</em>/;
COMMIT
/<em>!</em>/;</p>

<h1>at 620</h1>

<h1>140612  6:47:22 server id 1  end_log_pos 733 CRC32 0xb4c3b1c0  Query   thread_id=14    exec_time=0 error_code=0</h1>

<p>use <code>test</code>/<em>!</em>/;
SET TIMESTAMP=1402555642/<em>!</em>/;
SET @@session.pseudo_thread_id=14/<em>!</em>/;
DROP /<em>!40005 TEMPORARY </em>/ TABLE IF EXISTS <code>t</code>
/<em>!</em>/;</p>

<h1>at 733</h1>

<h1>140612  6:47:38 server id 1  end_log_pos 846 CRC32 0x1287fb24  Query   thread_id=16    exec_time=0 error_code=0</h1>

<p>SET TIMESTAMP=1402555658/<em>!</em>/;
SET @@session.pseudo_thread_id=16/<em>!</em>/;
DROP /<em>!40005 TEMPORARY </em>/ TABLE IF EXISTS <code>t</code>
/<em>!</em>/;
DELIMITER ;</p>

<h1>End of log file</h1>

<p>ROLLBACK /<em> added by mysqlbinlog </em>/;
/<em>!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE</em>/;
/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0</em>/;
```</p>

<h4>6.1</h4>

<p>```
mysql> select @@GTID_MODE;
+-------------+
| @@GTID_MODE |
+-------------+
| ON          |
+-------------+
1 row in set (0.00 sec)</p>

<p>mysql> select @@enforce_gtid_consistency;
+----------------------------+
| @@enforce_gtid_consistency |
+----------------------------+
|                          1 |
+----------------------------+
1 row in set (0.00 sec)</p>

<p>mysql> begin;
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql> create temporary table test.t(t int);
ERROR 1787 (HY000): When @@GLOBAL.ENFORCE_GTID_CONSISTENCY = 1, the statements CREATE TEMPORARY TABLE and DROP TEMPORARY TABLE can be executed in a non-transactional context only, and require that AUTOCOMMIT = 1.
```</p>
]]></content>
  </entry>
  
</feed>
